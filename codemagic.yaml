workflows:
  android-workflow:
    name: Android Workflow
    instance_type: mac_mini_m1
    environment:
      flutter: 3.19.0
      groups:
        - google-services
    scripts:
      - name: Decode google-services.json
        script: |
          echo $GSERVICES_JSON_B64 | base64 --decode > $CM_BUILD_DIR/android/app/google-services.json
      - name: Change package name
        script: |
          sed -i.bak 's/com.livehelperchat.mobile/com.dev_shadin.livechat/g' $CM_BUILD_DIR/android/app/build.gradle
      - name: Create Dummy Keystore and Properties (THE REAL, FINAL, BULLETPROOF FIX)
        script: |
          keytool -genkey -v -keystore $CM_BUILD_DIR/android/app/dummy.jks -alias dummy -keyalg RSA -keysize 2048 -validity 10000 -storepass dummypass -keypass dummypass -dname "CN=Dummy, OU=Dummy, O=Dummy, L=Dummy, S=Dummy, C=US"
          echo "storePassword=dummypass
          keyPassword=dummypass
          keyAlias=dummy
          storeFile=dummy.jks" > $CM_BUILD_DIR/android/app/key.properties
      - name: Get Flutter packages
        script: |
          flutter pub get
      - name: Build Unsigned Release APK
        script: |
          flutter build apk --release
    artifacts:
      - build/app/outputs/flutter-apk/app-release.apk
